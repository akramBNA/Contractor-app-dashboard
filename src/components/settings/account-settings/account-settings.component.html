<div *ngIf="!flag" class="flex items-center justify-center bg-white/40 backdrop-blur-sm relative w-full h-full min-h-[500px]">
  <div class="text-center space-y-6 px-4 py-8">
    <div class="mx-auto w-20 h-20 text-red-500">
      <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
          d="M18.364 5.636l-1.414 1.414M6.343 17.657l-1.414 1.414M5.636 5.636l1.414 1.414m12.728 12.728l-1.414-1.414M12 9v4m0 4h.01M21 12c0 4.97-4.03 9-9 9s-9-4.03-9-9 4.03-9 9-9 9 4.03 9 9z" />
      </svg>
    </div>

    <h1 class="text-2xl md:text-4xl font-semibold text-gray-800">Accès Refusé</h1>
    <p class="text-gray-600 text-lg md:text-xl">
      Vous n'êtes pas autorisé à accéder à cette page.<br />Seul l'administrateur y a accès.
    </p>
  </div>
</div>

<div *ngIf="flag" class="bg-white/40 backdrop-blur-sm relative max-h-screen px-4 py-8">
  <h1 class="text-3xl font-bold text-gray-800 mb-8 text-center">Liste des Utilisateurs</h1>

  <div *ngIf="isLoading" class="absolute inset-0 flex items-center justify-center bg-white bg-opacity-70 z-[9999]">
    <mat-spinner diameter="80"></mat-spinner>
  </div>

  <div class="bg-white shadow-md rounded-lg overflow-x-auto">
    <table class="min-w-full divide-y divide-gray-200">
      <thead class="bg-gray-100">
        <tr>
          <th class="px-4 py-2 text-left text-sm font-semibold text-gray-600">Prénom</th>
          <th class="px-4 py-2 text-left text-sm font-semibold text-gray-600">Nom</th>
          <th class="px-4 py-2 text-left text-sm font-semibold text-gray-600">Email</th>
          <th class="px-4 py-2 text-left text-sm font-semibold text-gray-600">Rôle</th>
          <th class="px-4 py-2 text-left text-sm font-semibold text-gray-600">Actions</th>
        </tr>
      </thead>
      <tbody class="divide-y divide-gray-200">
        <tr *ngFor="let user of users_data">
          <td class="px-4 py-2 text-sm text-gray-700">{{ user.user_name }}</td>
          <td class="px-4 py-2 text-sm text-gray-700">{{ user.user_lastname }}</td>
          <td class="px-4 py-2 text-sm text-gray-700">{{ user.user_email }}</td>
          <td class="px-4 py-2 text-sm text-gray-700">{{ user.role_type }}</td>
          <td class="px-4 py-2 text-sm flex space-x-2">
            <button mat-icon-button color="primary" style="cursor: pointer" (click)="onEditUser(user.user_id)">
              <mat-icon style="color: #3b82f6;">edit</mat-icon>
            </button>
            <button mat-icon-button color="warn" style="cursor: pointer" (click)="onDeleteUser(user.user_id)">
              <mat-icon style="color: #ef4444;">delete</mat-icon>
            </button>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

<hr class="my-12 border-gray-300" />

<div class="w-full max-w-full">
  <h2 class="text-2xl font-semibold text-gray-800 mb-6 text-center">Ajouter un Nouvel Utilisateur</h2>

  <form [formGroup]="usersForm" (ngSubmit)="onAddUser()" class="w-full px-4 md:px-0 mx-auto">
    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
      <div>
        <label class="block mb-1 font-medium text-gray-700">Prénom d'utilisateur</label>
        <input
          type="text"
          formControlName="user_name"
          placeholder="Prénom"
          class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-400"
        />
      </div>

      <div>
        <label class="block mb-1 font-medium text-gray-700">Nom d'utilisateur</label>
        <input
          type="text"
          formControlName="user_lastname"
          placeholder="Nom"
          class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-400"
        />
      </div>

      <div>
        <label class="block mb-1 font-medium text-gray-700">Email</label>
        <input
          type="email"
          formControlName="user_email"
          placeholder="Email"
          class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-400"
        />
      </div>

      <div>
        <label class="block mb-1 font-medium text-gray-700">Mot de passe</label>
        <input
          type="password"
          formControlName="user_password"
          placeholder="Mot de passe"
          class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-400"
        />
      </div>

      <div class="md:col-span-2 flex justify-center">
        <div class="w-full md:w-1/2">
          <label class="block mb-1 font-medium text-gray-700">Rôle</label>
          <select
            formControlName="user_role_id"
            class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-400"
          >
            <option value="" disabled selected>Choisissez un rôle</option>
            <option *ngFor="let role of roles_data" [value]="role.role_id">
              {{ role.role_type }}
            </option>
          </select>
        </div>
      </div>
    </div>

    <div class="mt-8 text-center">
      <button
        type="submit"
        class="bg-blue-600 text-white px-6 py-2 rounded-lg hover:bg-blue-700 transition"
        [disabled]="usersForm.invalid || isLoading"
      >
        Ajouter
      </button>
    </div>
  </form>
</div>


</div>
